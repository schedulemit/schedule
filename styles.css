        :root { 
            --univ-blue: #0f172a; 
            --bg-color: #f1f5f9; 
            --card-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
            --swap-mode-bg: #ecfdf5; --swap-mode-border: #4ade80;
            --move-mode-bg: #eff6ff; --move-mode-border: #60a5fa;
            --slot-bg: #f8fafc; --slot-hatch: #f1f5f9;
            --live-text: #854d0e; --live-color: #eab308; --live-bg: #fefce8; --live-border: #facc15;
            
            --diff-added: #dcfce7; --diff-added-border: #22c55e;
            --diff-removed: #fee2e2; --diff-removed-border: #ef4444;
            --diff-changed: #ffedd5; --diff-changed-border: #f97316;
            
            /* Додаткові змінні */
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --card-bg: white;
            --day-column-bg: #e2e8f0;
        }
        
        /* Гарна темна тема з правильними контрастами */
        body.dark-mode {
            --univ-blue: #93c5fd;
            --bg-color: #0a0e1a;
            --card-shadow: 0 4px 6px -1px rgba(0,0,0,0.4);
            --swap-mode-bg: #064e3b; --swap-mode-border: #34d399;
            --move-mode-bg: #1e3a8a; --move-mode-border: #60a5fa;
            --slot-bg: #1a1f2e; --slot-hatch: #232938;
            --live-text: #fcd34d; --live-color: #fbbf24; --live-bg: #451a03; --live-border: #f59e0b;
            
            --diff-added: #065f46; --diff-added-border: #34d399;
            --diff-removed: #991b1b; --diff-removed-border: #f87171;
            --diff-changed: #92400e; --diff-changed-border: #fb923c;
            
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --card-bg: #1e293b;
            --day-column-bg: #1a222e;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); margin: 0; padding: 1rem; color: var(--text-primary); transition: background-color 0.3s ease, color 0.3s ease; }
        
        /* Стилі для кнопок з індикаторами змін */
        .btn-sync.has-changes {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
            color: white !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4) !important;
            animation: pulse-changes 2s infinite;
        }
        
        .btn-sync.no-changes {
            opacity: 0.5;
            cursor: default;
        }
        
        .btn-sync.no-changes:hover {
            transform: none !important;
            opacity: 0.5 !important;
        }
        
        @keyframes pulse-changes {
            0%, 100% { box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); }
            50% { box-shadow: 0 4px 20px rgba(59, 130, 246, 0.6); }
        }
        
        body.dark-mode .btn-sync.has-changes {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%) !important;
            box-shadow: 0 4px 12px rgba(96, 165, 250, 0.5) !important;
        }
        
        /* Стильний tooltip для кнопок зі змінами */
        .btn-sync.has-changes::after {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
            padding: 10px 16px !important;
            font-size: 0.875rem !important;
            font-weight: 600 !important;
            border-radius: 10px !important;
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.4), 0 0 0 2px rgba(59, 130, 246, 0.2) !important;
            letter-spacing: 0.3px;
        }
        
        .btn-sync.has-changes::before {
            border-color: #2563eb transparent transparent transparent !important;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        
        body.dark-mode .btn-sync.has-changes::after {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%) !important;
            box-shadow: 0 8px 16px rgba(96, 165, 250, 0.5), 0 0 0 2px rgba(96, 165, 250, 0.3) !important;
        }
        
        body.dark-mode .btn-sync.has-changes::before {
            border-color: #3b82f6 transparent transparent transparent !important;
        }

        /* Темна тема */
        body.dark-mode .top-bar { 
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            box-shadow: 0 8px 16px -4px rgba(0,0,0,0.4);
            border: 1px solid #334155;
        }
        
        body.dark-mode .day-column { 
            background: var(--day-column-bg);
            border: 1px solid #334155;
        }
        
        body.dark-mode .day-header { 
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            color: #93c5fd;
            border: 1px solid #475569;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        body.dark-mode .day-column.current-day {
            background: #1a1a0f;
            border-color: #854d0e;
        }
        
        body.dark-mode .lesson-card { 
            background: linear-gradient(135deg, var(--card-bg) 0%, #283548 100%);
            color: var(--text-primary);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border-left-width: 4px;
        }
        
        body.dark-mode .lesson-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }
        
        body.dark-mode .lesson-card[data-type="Лекція"] { border-left-color: #fb923c; }
        body.dark-mode .lesson-card[data-type="Лабораторна"] { border-left-color: #34d399; }
        body.dark-mode .lesson-card[data-type="Практична"] { border-left-color: #60a5fa; }
        body.dark-mode .lesson-card[data-type="Семінар"] { border-left-color: #c084fc; }
        
        body.dark-mode .modal-box { 
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: var(--text-primary);
            border: 1px solid #475569;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        
        body.dark-mode .modal-header {
            color: #93c5fd;
            border-bottom: 2px solid #475569;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        
        body.dark-mode .form-input,
        body.dark-mode .form-input option { 
            background: #0f1419;
            color: var(--text-primary);
            border: 1px solid #475569;
        }
        
        body.dark-mode .form-input:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }
        
        body.dark-mode .form-label { color: #94a3b8; }
        
        body.dark-mode .btn-secondary { 
            background: #334155;
            color: #e2e8f0;
            border: 1px solid #475569;
        }
        
        body.dark-mode .btn-secondary:hover {
            background: #475569;
            transform: translateY(-1px);
        }
        
        body.dark-mode .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        body.dark-mode .btn-primary:hover {
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }
        
        body.dark-mode .time-slot { 
            background-color: var(--slot-bg);
            background-image: repeating-linear-gradient(45deg, var(--slot-bg), var(--slot-bg) 10px, var(--slot-hatch) 10px, var(--slot-hatch) 20px);
            border-color: #334155;
        }
        
        body.dark-mode .slot-number-badge { 
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        body.dark-mode .time-text { color: #94a3b8; }
        
        body.dark-mode .group-badge { 
            background: #334155;
            color: #93c5fd;
            border: 1px solid #475569;
        }
        
        body.dark-mode .group-badge:hover {
            background: #475569;
            border-color: #60a5fa;
        }
        
        body.dark-mode .type-badge {
            opacity: 0.9;
            font-weight: 700;
        }
        
        body.dark-mode .lesson-card[data-type="Лекція"] .type-badge { 
            background: #78350f;
            color: #fbbf24;
        }
        body.dark-mode .lesson-card[data-type="Лабораторна"] .type-badge { 
            background: #064e3b;
            color: #34d399;
        }
        body.dark-mode .lesson-card[data-type="Практична"] .type-badge { 
            background: #1e3a8a;
            color: #60a5fa;
        }
        body.dark-mode .lesson-card[data-type="Семінар"] .type-badge { 
            background: #581c87;
            color: #c084fc;
        }
        
        body.dark-mode .lesson-subject { color: #f1f5f9; }
        body.dark-mode .lesson-footer { color: var(--text-secondary); }
        
        body.dark-mode .status-badge { 
            opacity: 0.95;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        body.dark-mode .st-guest {
            background: #334155;
            color: #cbd5e1;
            border: 1px solid #475569;
        }
        
        body.dark-mode .st-admin {
            background: #1e3a8a;
            color: #93c5fd;
            border: 1px solid #3b82f6;
        }
        
        body.dark-mode .btn-sync { 
            background: linear-gradient(135deg, #334155 0%, #3f4c5e 100%);
            color: #e2e8f0;
            border: 1px solid #475569;
        }
        
        body.dark-mode .btn-sync:hover { 
            background: linear-gradient(135deg, #475569 0%, #556375 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        body.dark-mode .week-switcher { 
            background: #1e293b;
            border: 1px solid #334155;
        }
        
        body.dark-mode .week-btn { color: #64748b; }
        body.dark-mode .week-btn.active { 
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            color: #93c5fd;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        body.dark-mode .stats-container { color: var(--text-primary); }
        
        body.dark-mode .stat-card { 
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569;
            color: var(--text-primary);
        }
        
        body.dark-mode .stat-card-value { color: #93c5fd; }
        body.dark-mode .stat-title { color: #93c5fd; }
        body.dark-mode .stat-label { color: #cbd5e1; }
        
        body.dark-mode #compare-panel { 
            background: linear-gradient(135deg, #44230f 0%, #5a2e0e 100%);
            border: 1px solid #78350f;
            color: #fcd34d;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3), 0 8px 10px -6px rgba(0, 0, 0, 0.3);
        }
        
        body.dark-mode #compare-panel::before {
            background: linear-gradient(90deg, #f97316 0%, #fb923c 50%, #f97316 100%);
        }
        
        body.dark-mode .compare-header {
            border-bottom-color: rgba(251, 146, 60, 0.3);
        }
        
        body.dark-mode .compare-header > div:first-child {
            color: #fcd34d;
        }
        
        body.dark-mode .compare-header > div:first-child i {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
        }
        
        body.dark-mode .leg-item {
            background: rgba(0, 0, 0, 0.3);
            border-color: rgba(251, 146, 60, 0.3);
        }
        
        body.dark-mode .leg-item:hover {
            background: rgba(0, 0, 0, 0.4);
        }
        
        body.dark-mode .compare-legend > div:last-child {
            color: #fbbf24;
        }
        
        body.dark-mode .action-btn { 
            background: #334155;
            border: 1px solid #475569;
            color: #94a3b8;
        }
        
        body.dark-mode .action-btn:hover { 
            background: #475569;
            color: #f1f5f9;
        }
        
        body.dark-mode .add-btn-slot { color: #475569; }
        body.dark-mode .time-slot:hover .add-btn-slot { 
            color: #60a5fa;
            background: rgba(30, 41, 59, 0.8);
        }
        
        body.dark-mode .conflict-blinker {
            background-color: rgba(239, 68, 68, 0.2) !important;
            color: #fca5a5 !important;
        }
        
        body.dark-mode #darkModeToggle {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #451a03;
            border: 1px solid #fcd34d;
        }
        
        body.dark-mode #darkModeToggle:hover {
            background: linear-gradient(135deg, #fcd34d 0%, #fbbf24 100%);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
        }
        
        /* Мульти-вибір пропозицій */
        body.multi-choice-active .lesson-card:not(.source-selected) {
            opacity: 0.5;
            filter: grayscale(0.3);
        }
        body.multi-choice-active .lesson-card.source-selected {
            border: 3px solid #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
            animation: pulse-selected 2s infinite;
        }
        
        /* Деактивуємо всі активні зони на картках під час мульти-вибору */
        body.multi-choice-active .lesson-card {
            cursor: pointer !important; /* Тільки pointer для вибору пари */
        }
        body.multi-choice-active .lesson-card:active {
            cursor: pointer !important; /* Не grabbing */
        }
        body.multi-choice-active .lesson-card .card-actions {
            display: none !important;
            pointer-events: none !important;
        }
        body.multi-choice-active .lesson-card .mobile-actions {
            display: none !important;
            pointer-events: none !important;
        }
        body.multi-choice-active .lesson-card .group-badge,
        body.multi-choice-active .lesson-card .teacher-row,
        body.multi-choice-active .lesson-card .room-row {
            pointer-events: none !important;
            cursor: default !important;
        }
        body.multi-choice-active .lesson-card .group-badge:hover,
        body.multi-choice-active .lesson-card .teacher-row:hover {
            background: transparent !important;
            color: inherit !important;
            border-color: transparent !important;
        }
        
        @keyframes pulse-selected {
            0%, 100% { box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2); }
            50% { box-shadow: 0 0 0 6px rgba(249, 115, 22, 0.1); }
        }
        .time-slot.choice-target {
            background: #fff7ed;
            border: 3px dashed #f97316;
            position: relative;
        }
        .time-slot.choice-target::before {
            content: 'Варіант ' attr(data-priority);
            position: absolute;
            top: -8px;
            right: -8px;
            background: #f97316;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            z-index: 10;
        }
        .time-slot.choice-target.priority-1::before { background: #f97316; }
        .time-slot.choice-target.priority-2::before { background: #fb923c; }
        .time-slot.choice-target.priority-3::before { background: #fdba74; }
        
        /* Індикатор pending proposals на картках */
        .lesson-card.pending-proposal {
            border-left: 4px solid #f59e0b;
            position: relative;
        }
        .lesson-card.pending-proposal::after {
            content: '⏳';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #fef3c7;
            color: #d97706;
            padding: 2px 6px;
            border-radius: 50%;
            font-size: 12px;
            border: 2px solid #fbbf24;
            z-index: 15;
        }
        
        body.dark-mode .time-slot.choice-target {
            background: #78350f;
            border-color: #fb923c;
        }
        body.dark-mode .lesson-card.pending-proposal {
            border-left-color: #fbbf24;
        }
        body.dark-mode .lesson-card.pending-proposal::after {
            background: #78350f;
            color: #fbbf24;
            border-color: #f59e0b;
        }
        
        /* Покращені підказки для темної теми */
        body.dark-mode [data-tooltip]::after {
            background-color: #1e293b;
            color: #f1f5f9;
            border: 1px solid #475569;
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }
        
        body.dark-mode [data-tooltip]::before {
            border-color: #1e293b transparent transparent transparent;
        }
        
        .top-bar { background: white; padding: 1rem 1.5rem; border-radius: 0.75rem; box-shadow: var(--card-shadow); margin-bottom: 1.5rem; display: flex; flex-direction: column; gap: 0.75rem; }
        
        .top-bar-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; flex-wrap: wrap; }
        .top-bar-row.first { border-bottom: 1px solid #e2e8f0; padding-bottom: 0.75rem; }
        .top-bar-row.second { justify-content: center; }
        
        .header-left { display: flex; align-items: center; gap: 15px; }
        h2 { font-size: 1.25rem; font-weight: 800; color: var(--univ-blue); margin: 0; }
        
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; gap: 5px; }
        .st-guest { background: #e2e8f0; color: #475569; }
        .st-admin { background: #dbeafe; color: #1e40af; border: 1px solid #93c5fd; }

        .cloud-status { font-size: 0.85rem; font-weight: 600; display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; transition: all 0.3s; }
        .status-saved { color: #059669; background: #d1fae5; }
        .status-pending { color: #d97706; background: #fef3c7; }
        .status-error { color: #dc2626; background: #fee2e2; }

        .controls-right { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }

        /* ВИПРАВЛЕННЯ ТУТ: Додано flex-wrap для груп кнопок */
        .admin-controls { display: none; gap: 8px; align-items: center; flex-wrap: wrap; }
        .guest-controls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        
        /* Кнопки для конкретних режимів */
        .guest-only { display: inline-flex !important; }
        .admin-only { display: none !important; }
        body.is-admin .guest-only { display: none !important; }
        body.is-admin .admin-only { display: inline-flex !important; }
        
        .btn-sync { background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; padding: 6px 12px; border-radius: 6px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 0.85rem; transition: all 0.2s; white-space: nowrap; }
        .btn-sync:hover { background: #e2e8f0; transform: translateY(-1px); }
        .btn-sync:disabled { opacity: 0.4; cursor: not-allowed; pointer-events: none; }
        .btn-primary { background: #3b82f6 !important; color: white !important; border-color: #3b82f6 !important; }
        .btn-primary:hover { background: #2563eb !important; box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.4); }
        .btn-manual-save { border-color: #bbf7d0; color: #166534; }
        .btn-manual-save:hover { background: #dcfce7; }
        .btn-export { color: #2563eb; border-color: #bfdbfe; background: #eff6ff; }
        .btn-backup { color: #4f46e5; border-color: #c7d2fe; }
        .btn-filter-active { background: #fef3c7 !important; color: #d97706 !important; border-color: #fcd34d !important; }
        .btn-filter-active:hover { background: #fde68a !important; }
        
        body.is-admin .admin-controls { display: flex; }
        body.is-admin .guest-controls { display: none; }
        body.is-admin #loginBtn { display: none; }

        .week-switcher { display: flex; background: #f1f5f9; padding: 3px; border-radius: 8px; }
        .week-btn { padding: 6px 16px; border: none; background: transparent; font-size: 0.9rem; font-weight: 700; color: #94a3b8; cursor: pointer; border-radius: 6px; transition: all 0.2s; font-family: 'Inter', sans-serif; }
        .week-btn.active { background: white; color: var(--univ-blue); box-shadow: 0 1px 2px rgba(0,0,0,0.05); }

        /* Панелі дій - фіксовані внизу екрану */
        #action-panel, #filter-panel, #duplicate-panel { 
            display: none; 
            position: fixed; 
            bottom: 20px; 
            left: 20px;
            right: 20px;
            margin: 0 auto;
            transform: translateY(100px);
            padding: 0.75rem 1.5rem; 
            border-radius: 0.75rem; 
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.2), 0 8px 10px -6px rgba(0,0,0,0.1); 
            z-index: 1000; 
            text-align: center; 
            font-weight: 600; 
            font-size: 1rem; 
            align-items: center; 
            justify-content: center; 
            gap: 1rem;
            min-width: 300px;
            max-width: 600px;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #action-panel.show, #filter-panel.show, #duplicate-panel.show { 
            display: flex; 
            opacity: 1;
            transform: translateY(0);
        }
        
        #action-panel.mode-swap { background: var(--swap-mode-bg); border: 2px solid var(--swap-mode-border); color: #064e3b; }
        #action-panel.mode-move { background: var(--move-mode-bg); border: 2px solid var(--move-mode-border); color: #1e40af; }
        #duplicate-panel { background: #f0fdf4; border: 2px solid #22c55e; color: #065f46; }
        #filter-panel { background: #eff6ff; border: 2px solid #3b82f6; color: #1e3a8a; }
        
        body.dark-mode #action-panel.mode-swap { background: #064e3b; border-color: #34d399; color: #d1fae5; }
        body.dark-mode #action-panel.mode-move { background: #1e3a8a; border-color: #60a5fa; color: #dbeafe; }
        body.dark-mode #duplicate-panel { background: #064e3b; border-color: #22c55e; color: #d1fae5; }
        body.dark-mode #filter-panel { background: #1e3a8a; border-color: #3b82f6; color: #dbeafe; }
        
        .panel-btn {
            background: white;
            border: none;
            color: inherit;
            font-weight: 700;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .panel-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
        }
        
        body.dark-mode .panel-btn {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        #compare-panel { 
            display: none; 
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            border: 1px solid #fed7aa;
            color: #9a3412; 
            flex-direction: column; 
            gap: 12px; 
            padding: 20px; 
            border-radius: 16px; 
            margin-bottom: 1rem; 
            box-shadow: 0 10px 25px -5px rgba(251, 146, 60, 0.1), 0 8px 10px -6px rgba(251, 146, 60, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        #compare-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #f97316 0%, #fb923c 50%, #f97316 100%);
            background-size: 200% 100%;
            animation: shimmer 3s linear infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        #compare-panel.show { display: flex; }
        
        .compare-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            width: 100%; 
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(251, 146, 60, 0.2);
        }
        
        .compare-header > div:first-child {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.05rem;
            color: #9a3412;
        }
        
        .compare-header > div:first-child i {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            color: white;
            border-radius: 10px;
            font-size: 1rem;
            box-shadow: 0 4px 6px -1px rgba(249, 115, 22, 0.3);
        }
        
        .compare-legend { 
            display: flex; 
            gap: 20px; 
            font-size: 0.85rem; 
            align-items: center;
            flex-wrap: wrap;
        }
        
        .leg-item { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-weight: 600;
            background: rgba(255, 255, 255, 0.5);
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid rgba(251, 146, 60, 0.2);
            transition: all 0.2s;
        }
        
        .leg-item:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .dot { 
            width: 10px; 
            height: 10px; 
            border-radius: 50%;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }
        
        .compare-actions { 
            display: flex; 
            gap: 10px; 
        }
        
        .compare-legend > div:last-child {
            font-style: italic;
            font-size: 0.8rem;
            margin-left: auto;
            color: #c2410c;
            opacity: 0.8;
        }

        .schedule-grid { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 0.75rem; 
            align-items: start; 
            position: relative;
        }

        /* Водяний знак поточного тижня — завжди по центру екрана */
        #week-watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            z-index: 5;
            font-size: clamp(120px, 22vw, 220px);
            font-weight: 800;
            color: rgba(15, 23, 42, 0.12);
            line-height: 1;
            mix-blend-mode: multiply;
        }

        body.dark-mode #week-watermark {
            color: rgba(148, 163, 184, 0.18);
            mix-blend-mode: screen;
        }
        .day-column { background: #e2e8f0; border-radius: 0.75rem; padding: 0.5rem; min-height: 80vh; display: flex; flex-direction: column; gap: 0.5rem; transition: background 0.3s; }
        .day-column.current-day { background: var(--live-bg); border: 1px solid var(--live-border); }
        .day-header { 
            text-align: center; 
            padding: 0.5rem; 
            font-weight: 700; 
            color: var(--univ-blue); 
            background: rgba(255,255,255,0.95); 
            backdrop-filter: blur(10px);
            border-radius: 0.5rem; 
            font-size: 0.95rem; 
            position: sticky; 
            top: 0; 
            z-index: 200000; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .time-slot { background-color: var(--slot-bg); background-image: repeating-linear-gradient(45deg, var(--slot-bg), var(--slot-bg) 10px, var(--slot-hatch) 10px, var(--slot-hatch) 20px); border-radius: 0.5rem; padding: 0.4rem; min-height: 90px; border: 2px dashed #cbd5e1; position: relative; transition: all 0.2s; display: flex; flex-direction: column; gap: 0.4rem; }
        .time-slot.drag-over { background-image: none; background-color: white; border-color: #3b82f6; border-style: solid; }
        
        /* Блокування активних зон в режимах маніпуляцій */
        body.mode-move .lesson-card .group-badge,
        body.mode-move .lesson-card .teacher-row,
        body.mode-move .lesson-card .room-row,
        body.mode-move .lesson-card .card-actions,
        body.mode-swap .lesson-card .group-badge,
        body.mode-swap .lesson-card .teacher-row,
        body.mode-swap .lesson-card .room-row,
        body.mode-swap .lesson-card .card-actions,
        body.mode-duplicate .lesson-card .group-badge,
        body.mode-duplicate .lesson-card .teacher-row,
        body.mode-duplicate .lesson-card .room-row,
        body.mode-duplicate .lesson-card .card-actions {
            pointer-events: none !important;
            opacity: 0.5;
        }
        
        /* Режим переміщення */
        body.mode-move .time-slot { cursor: pointer; }
        body.mode-move .time-slot.move-available { border-color: #3b82f6; border-style: solid; background: #eff6ff; background-image: none; }
        body.mode-move .time-slot.move-available:hover { background: #dbeafe; border-color: #2563eb; }
        body.mode-move .time-slot.move-conflict { border-color: #ef4444; border-style: solid; background: #fef2f2; background-image: none; }
        body.mode-move .time-slot.move-conflict:hover { background: #fee2e2; border-color: #dc2626; }
        body.mode-move .time-slot.move-conflict::before { 
            content: '⚠️'; 
            position: absolute; 
            top: 4px; 
            right: 4px; 
            font-size: 14px;
            z-index: 10;
        }
        
        body.mode-swap .lesson-card { cursor: pointer; box-shadow: 0 0 0 2px #4ade80; }
        
        /* Режим мульти-вибору */
        body.multi-choice-active .time-slot { cursor: pointer; }
        body.multi-choice-active .time-slot.move-available { border-color: #3b82f6; border-style: solid; background: #eff6ff; background-image: none; }
        body.multi-choice-active .time-slot.move-available:hover { background: #dbeafe; border-color: #2563eb; }
        body.multi-choice-active .time-slot.move-conflict { border-color: #ef4444; border-style: solid; background: #fef2f2; background-image: none; }
        body.multi-choice-active .time-slot.move-conflict:hover { background: #fee2e2; border-color: #dc2626; }
        body.multi-choice-active .time-slot.move-conflict::before { 
            content: '⚠️'; 
            position: absolute; 
            top: 4px; 
            right: 4px; 
            font-size: 14px;
            z-index: 10;
        }
        
        /* Режим дублювання */
        body.mode-duplicate .time-slot { cursor: pointer; }
        body.mode-duplicate .time-slot.duplicate-available { border-color: #22c55e; border-style: solid; background: #f0fdf4; background-image: none; }
        body.mode-duplicate .time-slot.duplicate-available:hover { background: #dcfce7; border-color: #16a34a; }
        body.mode-duplicate .time-slot.duplicate-conflict { border-color: #ef4444; border-style: solid; background: #fef2f2; background-image: none; }
        body.mode-duplicate .time-slot.duplicate-conflict:hover { background: #fee2e2; border-color: #dc2626; }
        body.mode-duplicate .time-slot.duplicate-conflict::before { 
            content: '⚠️'; 
            position: absolute; 
            top: 4px; 
            right: 4px; 
            font-size: 14px;
            z-index: 10;
        }
        
        .time-slot.current-now { background-image: none; background-color: white; border: 2px solid var(--live-border); border-style: solid; box-shadow: 0 0 0 4px rgba(250, 204, 21, 0.2); }
        .time-slot.current-now::after { content: 'ЗАРАЗ'; position: absolute; bottom: 4px; right: 4px; font-size: 9px; font-weight: 800; color: var(--live-text); opacity: 0.9; pointer-events: none; }
        .time-slot.current-now .slot-number-badge { background-color: var(--live-color); }

        .slot-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
        .slot-number-badge { width: 20px; height: 20px; border-radius: 50%; background-color: #94a3b8; color: white; font-size: 11px; font-weight: 700; display: flex; align-items: center; justify-content: center; }
        .time-text { font-size: 10px; font-weight: 600; color: #94a3b8; }
        .add-btn-slot { margin-top: auto; width: 100%; text-align: center; padding: 2px; border-radius: 4px; color: #cbd5e1; cursor: pointer; font-size: 16px; }
        .time-slot:hover .add-btn-slot { color: #3b82f6; background: rgba(255,255,255,0.8); }

        .lesson-card { background: white; border-radius: 0.4rem; padding: 0.5rem; cursor: grab; box-shadow: 0 1px 2px rgba(0,0,0,0.1); position: relative; transition: transform 0.2s, opacity 0.2s, box-shadow 0.2s; border-left: 4px solid #cbd5e1; display: flex; flex-direction: column; gap: 2px; }
        .lesson-card[data-type="Лекція"] { border-left-color: #f59e0b; }
        .lesson-card[data-type="Лабораторна"] { border-left-color: #10b981; }
        .lesson-card[data-type="Практична"] { border-left-color: #3b82f6; }
        .lesson-card[data-type="Семінар"] { border-left-color: #8b5cf6; }
        .lesson-card:hover { transform: translateY(-1px); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); z-index: 10; }
        
        body.spotlight-active .lesson-card { opacity: 0.2; pointer-events: none; filter: grayscale(0.5); }
        body.spotlight-active .lesson-card.highlighted { opacity: 1; pointer-events: auto; filter: none; transform: scale(1.03); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); z-index: 50; border: 1px solid #3b82f6; }
        .lesson-card.action-source { opacity: 0.6 !important; pointer-events: none; filter: grayscale(0.8); }

        .diff-added { background-color: var(--diff-added) !important; border: 2px solid var(--diff-added-border); }
        .diff-changed { background-color: var(--diff-changed) !important; border: 2px solid var(--diff-changed-border); }
        .diff-removed { 
            background-color: var(--diff-removed) !important; 
            border: 3px solid var(--diff-removed-border) !important; 
            opacity: 0.85; 
            position: relative;
        }
        
        /* Кнопки на видалених картках мають працювати */
        .diff-removed .diff-actions {
            pointer-events: auto;
        }
        
        .diff-removed::after { 
            content: 'ВИДАЛЕНО'; 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%) rotate(-12deg); 
            color: #dc2626; 
            font-weight: 900; 
            font-size: 0.75rem; 
            opacity: 0.9; 
            pointer-events: none; 
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #dc2626; 
            padding: 4px 12px; 
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
            letter-spacing: 1px;
        }
        
        body.dark-mode .diff-removed::after {
            background: rgba(30, 30, 30, 0.95);
            color: #fca5a5;
            border-color: #f87171;
            box-shadow: 0 2px 8px rgba(248, 113, 113, 0.4);
        }
        
        /* Стиль для переміщених пар (помаранчевий з БУЛО) */
        .diff-moved-source { 
            background-color: #fed7aa !important; 
            border: 2px solid #fb923c !important; 
            opacity: 0.5; 
            filter: grayscale(0.6); 
            pointer-events: none;
            position: relative;
        }
        .diff-moved-source::after { 
            content: 'БУЛО'; 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%) rotate(-12deg); 
            color: #ea580c; 
            font-weight: 800; 
            font-size: 0.7rem; 
            opacity: 0.6; 
            pointer-events: none; 
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid #fb923c; 
            padding: 3px 10px; 
            border-radius: 5px;
            box-shadow: 0 2px 6px rgba(251, 146, 60, 0.2);
        }
        
        body.dark-mode .diff-moved-source {
            background-color: #7c2d12 !important;
            border-color: #fb923c !important;
        }
        
        body.dark-mode .diff-moved-source::after {
            background: rgba(30, 30, 30, 0.9);
            color: #fdba74;
            border-color: #fb923c;
        }
        
        .diff-context { opacity: 0.4; filter: grayscale(1); pointer-events: none; }
        .diff-processed { opacity: 1; filter: none; border: 2px solid #cbd5e1; }
        
        /* Підсвічування пов'язаних пар при hover */
        .lesson-card.hover-highlight {
            box-shadow: 0 0 0 3px #3b82f6, 0 8px 16px rgba(59, 130, 246, 0.3) !important;
            transform: scale(1.02) !important;
            z-index: 100 !important;
        }
        
        body.dark-mode .lesson-card.hover-highlight {
            box-shadow: 0 0 0 3px #60a5fa, 0 8px 16px rgba(96, 165, 250, 0.4) !important;
        }
        
        /* Анімація переміщення пари */
        .lesson-card.animating-move {
            position: fixed !important;
            z-index: 9999 !important;
            pointer-events: none;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .lesson-card.fade-out {
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s ease-out;
        }
        
        .lesson-card.fade-in {
            animation: fadeInScale 0.4s ease-out;
        }
        
        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Ghost classes для заявок від викладачів */
        .lesson-card.request-source {
            border: 3px solid #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
            position: relative;
        }
        .lesson-card.request-source::before {
            content: 'ПЕРЕНЕСТИ';
            position: absolute;
            top: -12px;
            right: -6px;
            background: #f97316;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 800;
            z-index: 15;
        }
        
        .lesson-card.request-ghost {
            background-color: #fff7ed !important;
            border: 2px dashed #f97316 !important;
            opacity: 0.8;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }
        .lesson-card.request-ghost:hover {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
            z-index: 10;
        }
        .lesson-card.request-ghost.priority-1 {
            border-color: #f97316;
            border-width: 3px;
            background: #fff7ed !important;
        }
        .lesson-card.request-ghost.priority-2 {
            border-color: #fb923c;
            background: #fef9e7 !important;
        }
        .lesson-card.request-ghost.priority-3 {
            border-color: #fcd34d;
            background: #fefce8 !important;
        }
        .lesson-card.request-ghost::before {
            content: 'Варіант ' attr(data-priority);
            position: absolute;
            top: -10px;
            right: -6px;
            background: #f97316;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 800;
            z-index: 15;
        }
        .lesson-card.request-ghost.priority-1::before {
            background: #f97316;
            content: 'Пріоритет 1';
        }
        .lesson-card.request-ghost.priority-2::before {
            background: #fb923c;
            content: 'Пріоритет 2';
        }
        .lesson-card.request-ghost.priority-3::before {
            background: #fcd34d;
            color: #92400e;
            content: 'Пріоритет 3';
        }
        .lesson-card.request-ghost::after {
            content: '✓ Затвердити';
            position: absolute;
            bottom: 4px;
            left: 4px;
            right: 4px;
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 4px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 700;
            text-align: center;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .lesson-card.request-ghost:hover::after {
            opacity: 1;
        }
        
        body.dark-mode .lesson-card.request-source {
            border-color: #fb923c;
            box-shadow: 0 0 0 3px rgba(251, 146, 60, 0.3);
        }
        body.dark-mode .lesson-card.request-ghost {
            background-color: #78350f !important;
            border-color: #fb923c !important;
        }
        body.dark-mode .lesson-card.request-ghost.priority-2 {
            background: #92400e !important;
            border-color: #fb923c !important;
        }
        body.dark-mode .lesson-card.request-ghost.priority-3 {
            background: #a16207 !important;
            border-color: #fcd34d !important;
        }

        @keyframes soft-pulse { 0% { background-color: transparent; } 50% { background-color: #fecaca; color: #b91c1c; } 100% { background-color: transparent; } }
        .lesson-card.conflict { border-left-color: #ef4444 !important; background-color: #fff1f2; box-shadow: 0 0 0 1px #fda4af; }
        .conflict-blinker { animation: soft-pulse 2s infinite ease-in-out; border-radius: 4px; padding: 0 4px; margin: 0 -4px; }

        .card-top-row { display: flex; align-items: center; justify-content: flex-start; gap: 8px; margin-bottom: 2px; padding-right: 20px; }
        .group-badge { font-size: 10px; font-weight: 700; color: #475569; background: #f1f5f9; padding: 1px 4px; border-radius: 3px; cursor: pointer; transition: background 0.2s; border: 1px solid transparent; max-width: 65%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: inline-block; }
        .group-badge:hover { background: #e2e8f0; border-color: #cbd5e1; max-width: none; position: relative; z-index: 20; }
        .type-badge { font-size: 9px; font-weight: 700; text-transform: uppercase; padding: 1px 5px; border-radius: 8px; }
        .lesson-card[data-type="Лекція"] .type-badge { background: #fef3c7; color: #d97706; }
        .lesson-card[data-type="Лабораторна"] .type-badge { background: #d1fae5; color: #059669; }
        .lesson-card[data-type="Практична"] .type-badge { background: #dbeafe; color: #2563eb; }
        .lesson-card[data-type="Семінар"] .type-badge { background: #ede9fe; color: #7c3aed; }
        .lesson-subject { font-size: 11px; font-weight: 700; color: #0f172a; line-height: 1.25; margin-bottom: 2px; }
        .lesson-footer { font-size: 9px; color: #64748b; display: flex; flex-direction: column; gap: 1px; }
        .info-row { display: flex; align-items: center; gap: 4px; border-radius: 2px; }
        .teacher-row { cursor: pointer; padding: 0 2px; margin-left: -2px; transition: background 0.2s; }
        .teacher-row:hover { background: #e2e8f0; color: #0f172a; }
        
        .card-actions { position: absolute; top: 4px; right: 4px; display: flex; gap: 2px; opacity: 0; transition: opacity 0.1s; }
        .lesson-card:hover .card-actions { opacity: 1; }
        .action-btn { width: 20px; height: 20px; background: white; border: 1px solid #e2e8f0; display: flex; align-items: center; justify-content: center; border-radius: 4px; color: #94a3b8; cursor: pointer; font-size: 10px; transition: all 0.2s; }
        .action-btn:hover { border-color: #64748b; color: #0f172a; background: #f8fafc; }
        
        .btn-duplicate { color: #d97706; background: #fef3c7; border-color: #fde68a; }
        .btn-duplicate:hover { background: #fde047; color: #a16207; border-color: #fbbf24; }
        
        .btn-move { color: #3b82f6; background: #eff6ff; border-color: #bfdbfe; }
        .btn-move:hover { background: #dbeafe; color: #1d4ed8; border-color: #60a5fa; }
        
        .btn-swap { color: #8b5cf6; background: #f5f3ff; border-color: #ddd6fe; }
        .btn-swap:hover { background: #ede9fe; color: #6d28d9; border-color: #c4b5fd; }
        
        .btn-edit { color: #06b6d4; background: #ecfeff; border-color: #a5f3fc; }
        .btn-edit:hover { background: #cffafe; color: #0e7490; border-color: #67e8f9; }
        
        .btn-delete { color: #ef4444; background: #fef2f2; border-color: #fecaca; }
        .btn-delete:hover { background: #fee2e2; color: #dc2626; border-color: #fca5a5; }
        
        .mobile-actions { display: none; }
        .mobile-menu-dropdown { display: none; position: absolute; top: 25px; right: 0; background: white; border: 1px solid #e2e8f0; border-radius: 6px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); z-index: 100; min-width: 150px; }
        .mobile-menu-dropdown.show { display: block; }
        .mobile-menu-item { padding: 8px 12px; font-size: 12px; font-weight: 600; color: #334155; border-bottom: 1px solid #f1f5f9; display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .mobile-menu-item:last-child { border-bottom: none; }
        .mobile-menu-item:active { background: #f8fafc; }

        .diff-actions { position: absolute; top: 4px; right: 4px; display: flex; gap: 4px; z-index: 20; }
        .btn-approve { background: #dcfce7; border: 1px solid #22c55e; color: #166534; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 4px; cursor: pointer; }
        .btn-approve:hover { background: #22c55e; color: white; }
        .btn-reject { background: #fee2e2; border: 1px solid #ef4444; color: #991b1b; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 4px; cursor: pointer; }
        .btn-reject:hover { background: #ef4444; color: white; }

        .note-text { font-size: 9px; color: #d97706; margin-top: 2px; font-style: italic; border-top: 1px solid #f1f5f9; padding-top: 2px;}

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 200000; }
        .modal-overlay.open { display: flex; }
        .modal-box { background: white; padding: 1.5rem; border-radius: 0.75rem; width: 380px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .modal-header { font-size: 1.1rem; font-weight: 700; color: var(--univ-blue); margin-bottom: 1rem; }
        .form-group { margin-bottom: 0.8rem; }
        .form-label { display: block; font-size: 0.8rem; font-weight: 600; color: #475569; margin-bottom: 0.3rem; }
        .form-input { width: 100%; padding: 0.6rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; font-family: inherit; font-size: 0.9rem; box-sizing: border-box; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 0.5rem; margin-top: 1.5rem; }
        .btn { padding: 0.6rem 1.2rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; font-size: 0.9rem;}
        .btn-primary { background: var(--univ-blue); color: white; }
        .btn-secondary { 
            background: #f1f5f9; 
            color: #475569; 
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .btn-secondary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(100, 116, 139, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn-secondary:hover::before {
            width: 300px;
            height: 300px;
        }
        .btn-secondary:hover {
            background: #e2e8f0;
            color: #334155;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(71, 85, 105, 0.2);
        }
        .btn-secondary:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(71, 85, 105, 0.2);
        }
        
        .btn-danger { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; }
        
        .btn-success { 
            background: #dcfce7; 
            color: #166534; 
            border: 1px solid #bbf7d0; 
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .btn-success::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(34, 197, 94, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn-success:hover::before {
            width: 300px;
            height: 300px;
        }
        .btn-success:hover {
            background: #bbf7d0;
            color: #14532d;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.3);
        }
        .btn-success:active {
            transform: translateY(0) scale(1);
            box-shadow: 0 2px 6px rgba(34, 197, 94, 0.3);
        }
        .btn-success i {
            transition: transform 0.3s ease;
        }
        .btn-success:hover i {
            transform: rotate(360deg) scale(1.2);
        }

        .stats-container { display: flex; flex-direction: column; gap: 1.5rem; max-height: 70vh; overflow-y: auto; padding-right: 5px; }
        .stat-section { border-bottom: 1px solid #e2e8f0; padding-bottom: 1rem; }
        .stat-section:last-child { border-bottom: none; }
        .stat-title { font-size: 0.9rem; font-weight: 700; color: var(--univ-blue); margin-bottom: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; font-size: 0.85rem; }
        .stat-label { width: 35%; color: #334155; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .stat-bar-container { width: 55%; background: #f1f5f9; height: 8px; border-radius: 4px; overflow: hidden; }
        .stat-bar { height: 100%; border-radius: 4px; }
        .stat-value { width: 10%; text-align: right; font-weight: 700; color: #0f172a; }
        .bar-blue { background: #3b82f6; } .bar-green { background: #10b981; } .bar-orange { background: #f59e0b; } .bar-red { background: #ef4444; } .bar-purple { background: #8b5cf6; } .bar-gray { background: #cbd5e1; }
        
        /* Таби для статистики */
        .stats-tabs { display: flex; gap: 8px; margin-bottom: 1rem; border-bottom: 2px solid #e2e8f0; }
        .stats-tab { padding: 8px 16px; font-size: 0.85rem; font-weight: 600; color: #64748b; background: none; border: none; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s; }
        .stats-tab:hover { color: #334155; }
        .stats-tab.active { color: var(--univ-blue); border-bottom-color: var(--univ-blue); }
        .stats-tab-content { display: none; }
        .stats-tab-content.active { display: block; }
        
        /* Картки для швидкої статистики */
        .stat-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.75rem; margin-bottom: 1rem; }
        .stat-card { background: #f8fafc; border-radius: 8px; padding: 0.75rem; text-align: center; border: 1px solid #e2e8f0; }
        .stat-card-value { font-size: 1.5rem; font-weight: 800; color: var(--univ-blue); }
        .stat-card-label { font-size: 0.75rem; color: #64748b; margin-top: 4px; font-weight: 500; }
        
        /* Теплова карта */
        .heatmap { display: grid; grid-template-columns: 60px repeat(5, 1fr); gap: 4px; font-size: 0.75rem; }
        .heatmap-cell { background: #f1f5f9; padding: 8px 4px; text-align: center; border-radius: 4px; font-weight: 600; }
        .heatmap-header { background: var(--univ-blue); color: white; }
        .heatmap-time { background: #e2e8f0; color: #475569; font-size: 0.7rem; }
        .heatmap-data { cursor: pointer; transition: transform 0.2s; }
        .heatmap-data:hover { transform: scale(1.05); }
        .heat-0 { background: #f1f5f9; color: #94a3b8; }
        .heat-1 { background: #dbeafe; color: #1e40af; }
        .heat-2 { background: #93c5fd; color: #1e3a8a; }
        .heat-3 { background: #3b82f6; color: white; }
        .heat-4 { background: #1d4ed8; color: white; }
        .heat-5 { background: #1e3a8a; color: white; }
        
        /* Кругова діаграма */
        .pie-chart { width: 120px; height: 120px; border-radius: 50%; margin: 0 auto; position: relative; }
        .pie-legend { display: flex; flex-direction: column; gap: 6px; margin-top: 1rem; }
        .pie-legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; }
        .pie-legend-color { width: 16px; height: 16px; border-radius: 3px; }
        
        /* Список з іконками */
        .stat-list { display: flex; flex-direction: column; gap: 8px; }
        .stat-list-item { display: flex; align-items: center; gap: 10px; padding: 8px; background: #f8fafc; border-radius: 6px; font-size: 0.85rem; }
        .stat-list-icon { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; background: #e2e8f0; border-radius: 50%; font-size: 0.7rem; color: #475569; flex-shrink: 0; }
        .stat-list-text { flex: 1; color: #334155; font-weight: 500; }
        .stat-list-value { font-weight: 700; color: var(--univ-blue); }
        
        /* Порожні слоти */
        .empty-slots { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .empty-slot-day { background: #f8fafc; border-radius: 8px; padding: 10px; border: 1px solid #e2e8f0; }
        .empty-slot-day-name { font-weight: 700; font-size: 0.8rem; color: var(--univ-blue); margin-bottom: 8px; text-align: center; }
        .empty-slot-list { display: flex; flex-direction: column; gap: 4px; }
        .empty-slot-item { background: white; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; text-align: center; color: #64748b; border: 1px dashed #cbd5e1; }
        
        /* Конфлікти */
        .conflict-item { background: #fef2f2; border: 1px solid #fecaca; border-radius: 6px; padding: 10px; margin-bottom: 8px; }
        .conflict-header { font-weight: 700; color: #dc2626; font-size: 0.85rem; margin-bottom: 6px; }
        .conflict-details { font-size: 0.75rem; color: #7f1d1d; line-height: 1.4; }

        
        /* Toggle кнопка Мої/Всі пари для викладачів (на всіх пристроях) */
        #teacherToggle {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }
        
        #teacherToggle:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        #teacherToggle i {
            font-size: 1rem;
        }
        
        body.dark-mode #teacherToggle {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
        }

        /* ОНОВЛЕНИЙ БЛОК ДЛЯ МОБІЛЬНИХ */
        @media (max-width: 768px) {
            .schedule-grid { grid-template-columns: 1fr; gap: 2rem; }
            .top-bar { padding: 0.75rem; }
            .top-bar-row { flex-direction: column; align-items: stretch; gap: 0.5rem; }
            .top-bar-row.first { padding-bottom: 0.75rem; }
            .header-left { flex-direction: column; gap: 0.75rem; width: 100%; text-align: center; }
            .controls-right { width: 100%; justify-content: center; gap: 0.5rem; flex-wrap: wrap; }
            .guest-controls, .admin-controls { justify-content: center; gap: 0.5rem; flex-wrap: wrap; }
            
            /* Компактні кнопки - тільки іконки */
            .btn-sync {
                padding: 0.5rem;
                font-size: 1rem;
                min-width: auto;
            }
            .btn-sync span,
            .btn-sync .fa-solid + span {
                display: none; /* Ховаємо текст, залишаємо тільки іконки */
            }
            
            .week-switcher { width: 100%; justify-content: center; }
            .modal-box { width: 90%; padding: 1rem; }
            h2 { font-size: 1.1rem; text-align: center; }
            .day-column { min-height: auto; }
            .card-actions { display: none !important; }
            .mobile-actions { display: block; position: absolute; top: 4px; right: 4px; }
            .card-top-row { padding-right: 25px; }
            
            /* Адаптивність compare-panel */
            #compare-panel { padding: 10px; gap: 8px; }
            .compare-header { flex-direction: column; gap: 10px; align-items: stretch; }
            .compare-actions { flex-direction: column; width: 100%; }
            .compare-actions button { width: 100%; }
            .compare-legend { flex-wrap: wrap; gap: 10px; font-size: 0.75rem; }
                background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            }
        }

        @media (max-width: 768px) {
            #action-panel, #filter-panel, #duplicate-panel {
                bottom: 10px;
                left: 10px;
                right: 10px;
                transform: translateX(0) translateY(100px);
                min-width: auto;
                max-width: none;
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            #action-panel.show, #filter-panel.show, #duplicate-panel.show {
                transform: translateX(0) translateY(0);
            }
            
            .panel-btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
        }
            
            /* Покращена панель фільтрів на мобільних */
            #filter-panel { 
                position: fixed !important;
                top: auto !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                border-radius: 0 !important;
                padding: 15px !important;
                font-size: 0.9rem !important;
                z-index: 1000 !important;
                box-shadow: 0 -6px 12px -2px rgba(0,0,0,0.2) !important;
                background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%) !important;
                color: white !important;
                border: none !important;
            }
            
            #filter-panel button {
                background: white !important;
                color: #2563eb !important;
                border: none !important;
                padding: 8px 16px !important;
                border-radius: 6px !important;
                font-weight: 700 !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            }
            
            #filter-panel #filter-msg {
                color: white !important;
                font-weight: 700 !important;
            }
            
            /* Адаптивність статистики */
            .stat-cards { grid-template-columns: repeat(2, 1fr); }
            .empty-slots { grid-template-columns: 1fr; }
            .heatmap { grid-template-columns: 50px repeat(5, 1fr); font-size: 0.65rem; }
            .heatmap-cell { padding: 6px 2px; }
            .stats-tabs { overflow-x: auto; }
            .stats-tab { font-size: 0.8rem; padding: 6px 12px; white-space: nowrap; }
        }
        
        /* Стилі для модального вікна допомоги */
        .help-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .help-section:last-child {
            border-bottom: none;
        }
        
        .help-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--univ-blue);
            margin: 0 0 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .help-item {
            margin-bottom: 1rem;
            padding-left: 0.5rem;
        }
        
        .help-icon-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.3rem;
        }
        
        .help-icon {
            font-size: 1.5rem;
        }
        
        .help-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.3rem 0.6rem;
            border-radius: 1rem;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .help-buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .help-button-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
        }
        
        .help-btn-demo {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            min-width: 32px;
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .help-action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 4px;
            border: 1px solid;
            font-size: 0.85rem;
        }
        
        .help-button-item strong {
            display: block;
            font-size: 0.9rem;
            color: var(--univ-blue);
            margin-bottom: 0.2rem;
        }
        
        .help-button-item p {
            margin: 0;
            font-size: 0.8rem;
            color: #64748b;
            line-height: 1.4;
        }
        
        .help-type-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 1rem;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .help-buttons-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Гарні підказки замість стандартних */
        [data-tooltip] { position: relative; cursor: pointer; }

        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%; /* З'являється зверху над кнопкою */
            left: 50%;
            transform: translateX(-50%) translateY(5px);
            background-color: #0f172a; /* Темно-синій колір, як в меню */
            color: #fff;
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            pointer-events: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        /* Трикутничок знизу підказки */
        [data-tooltip]::before {
            content: '';
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%) translateY(5px);
            border-width: 5px;
            border-style: solid;
            border-color: #0f172a transparent transparent transparent;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 1000;
        }

        /* Поява при наведенні */
        [data-tooltip]:hover::after,
        [data-tooltip]:hover::before {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        /* Спеціальний стильний tooltip для кнопки варіантів переносу */
        #multiChoiceBtn[data-tooltip]::after {
            white-space: normal;
            max-width: 280px;
            text-align: center;
            padding: 10px 14px;
            font-size: 0.8rem;
            line-height: 1.4;
            background-color: #0f172a;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        
        #multiChoiceBtn[data-tooltip]::before {
            border-color: #0f172a transparent transparent transparent;
        }
        
        body.dark-mode #multiChoiceBtn[data-tooltip]::after {
            background-color: #1e293b;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }
        
        body.dark-mode #multiChoiceBtn[data-tooltip]::before {
            border-color: #3b82f6 transparent transparent transparent;
        }
        
        /* Анімації для повідомлень */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* Анімація для індикатора змін */
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(250, 204, 21, 0.7);
            }
            50% { 
                box-shadow: 0 0 0 6px rgba(250, 204, 21, 0);
            }
        }
        
        @keyframes modalBounce {
            0% { 
                opacity: 0;
                transform: scale(0.8) translateY(-20px);
            }
            50% {
                transform: scale(1.02) translateY(0);
            }
            100% { 
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        #draft-alert {
            animation: pulse-glow 2s infinite;
            transition: all 0.3s ease;
        }
        
        #draft-alert:hover {
            background: #facc15 !important;
            color: #713f12 !important;
            transform: scale(1.05);
        }

        /* Глобальний лоадер з прогрес-баром + скелетон сітки (скопійовано з rozklad_kaf16.html) */
        .global-loader {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at top, rgba(59,130,246,0.15), transparent 50%), #eef2ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1500;
            color: #0f172a;
            transition: opacity 0.25s ease, visibility 0.25s ease;
        }
        .global-loader.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .global-loader-header {
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 0.03em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .global-loader-subtitle {
            font-size: 0.85rem;
            opacity: 0.85;
            margin-bottom: 18px;
        }
        .global-loader-bar {
            width: min(320px, 80vw);
            height: 6px;
            border-radius: 999px;
            background: rgba(148,163,184,0.4);
            overflow: hidden;
            margin-bottom: 18px;
        }
        .global-loader-bar-fill {
            width: 40%;
            height: 100%;
            border-radius: inherit;
            background: linear-gradient(90deg, #38bdf8, #3b82f6, #6366f1);
            animation: loader-indeterminate 1.4s ease-in-out infinite;
        }
        @keyframes loader-indeterminate {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(0%); }
            100% { transform: translateX(120%); }
        }
        .global-loader-skeleton {
            display: grid;
            grid-template-columns: repeat(5, minmax(0, 1fr));
            gap: 10px;
            width: min(900px, 94vw);
            max-width: 100%;
            margin-top: 10px;
        }
        .global-loader-skeleton-day {
            background: rgba(255,255,255,0.9);
            border-radius: 14px;
            padding: 10px 8px 12px;
            border: 1px solid rgba(148,163,184,0.35);
            box-shadow: 0 10px 25px rgba(15,23,42,0.18);
        }
        .global-loader-skeleton-day-header {
            height: 16px;
            border-radius: 999px;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #e5e7eb 0%, #cbd5e1 40%, #e5e7eb 80%);
            background-size: 200% 100%;
            animation: shimmer 2s linear infinite;
        }
        .global-loader-skeleton-slot {
            height: 38px;
            border-radius: 10px;
            margin-bottom: 6px;
            background: linear-gradient(90deg, #e5e7eb 0%, #d1d5db 40%, #e5e7eb 80%);
            background-size: 220% 100%;
            animation: shimmer 2.4s linear infinite;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        body.dark-mode .global-loader {
            background: radial-gradient(circle at top, rgba(59,130,246,0.25), transparent 45%), rgba(15,23,42,0.98);
            color: white;
        }
        body.dark-mode .global-loader-skeleton-day {
            background: rgba(15,23,42,0.9);
            border-color: rgba(148,163,184,0.4);
            box-shadow: 0 12px 30px rgba(15,23,42,0.85);
        }
        body.dark-mode .global-loader-skeleton-day-header {
            background: linear-gradient(90deg, #1e293b 0%, #0f172a 40%, #1e293b 80%);
        }
        body.dark-mode .global-loader-skeleton-slot {
            background: linear-gradient(90deg, #0f172a 0%, #020617 40%, #0f172a 80%);
        }

        /* Під час завантаження не підсвічуємо поточний день / пару та заголовки (як у rozklad_kaf16.html) */
        body.loading .day-column.current-day {
            background: #e2e8f0;
            border: 1px solid #e2e8f0;
        }
        body.loading .time-slot.current-now {
            background-image: repeating-linear-gradient(45deg, var(--slot-bg), var(--slot-bg) 10px, var(--slot-hatch) 10px, var(--slot-hatch) 20px);
            border-color: #cbd5e1;
            box-shadow: none;
        }
        body.loading .day-header {
            opacity: 0;
        }

        /* Анімований перехід для сітки розкладу — мінімалістичний, у стилі iOS */
        #schedule-container.schedule-fade {
            animation: schedule-fade 260ms cubic-bezier(0.22, 0.8, 0.22, 1);
            transform-origin: top center;
        }
        @keyframes schedule-fade {
            0% {
                opacity: 0;
                transform: translateY(4px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Горизонтальна анімація для свайпів між тижнями (вліво / вправо) */
        #schedule-container.week-swipe-left {
            animation: week-swipe-left 260ms cubic-bezier(0.22, 0.8, 0.22, 1);
        }
        #schedule-container.week-swipe-right {
            animation: week-swipe-right 260ms cubic-bezier(0.22, 0.8, 0.22, 1);
        }
        @keyframes week-swipe-left {
            0% {
                opacity: 0.3;
                transform: translateX(24px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
        @keyframes week-swipe-right {
            0% {
                opacity: 0.3;
                transform: translateX(-24px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Мобільна нижня навігація для перемикання тижнів (вимкнена) */
        .mobile-week-nav {
            display: none;
        }

        /* Current week indicator */
        .current-week-indicator {
            display: none;
            background: #f8fafc;
            color: #475569;
            padding: 12px 20px;
            border-radius: 12px;
            margin: 16px 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            align-items: center;
            justify-content: center;
            gap: 10px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .current-week-indicator:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
        }
        
        .current-week-indicator i {
            font-size: 1rem;
            color: #3b82f6;
        }
        
        .current-week-indicator span {
            letter-spacing: 0.3px;
        }
        
        body.dark-mode .current-week-indicator {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 50%, #1e293b 100%);
            color: white;
            box-shadow: 0 8px 16px rgba(30, 64, 175, 0.4), 0 2px 4px rgba(30, 64, 175, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        body.dark-mode .current-week-indicator::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transform: rotate(45deg);
            animation: shimmer-indicator 3s infinite;
        }
        
        @keyframes shimmer-indicator {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }
        
        body.dark-mode .current-week-indicator:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(30, 64, 175, 0.5), 0 4px 8px rgba(30, 64, 175, 0.3);
        }
        
        body.dark-mode .current-week-indicator i {
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            position: relative;
            z-index: 1;
        }
        
        body.dark-mode .current-week-indicator span {
            position: relative;
            z-index: 1;
        }